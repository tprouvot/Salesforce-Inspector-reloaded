import{Extension as e}from"./Extension.js";export class AckExtension extends e{#a=!1;#b=0;#c(t,s){this.cometd._debug(t,s)}registered(e,t){super.registered(e,t),this.#c("AckExtension: executing registration callback")}unregistered(){this.#c("AckExtension: executing unregistration callback"),super.unregistered()}incoming(e){let t=e.channel,s=e.ext;if("/meta/handshake"===t){if(s){let c=s.ack;if("object"==typeof c){this.#a=!0===c.enabled;let n=c.batch;"number"==typeof n&&(this.#b=n)}else this.#a=!0===c}this.#c("AckExtension: server supports acknowledgements",this.#a)}else"/meta/connect"===t&&e.successful&&this.#a&&s&&"number"==typeof s.ack&&(this.#b=s.ack,this.#c("AckExtension: server sent batch",this.#b));return e}outgoing(e){let t=e.channel;return e.ext||(e.ext={}),"/meta/handshake"===t?(e.ext.ack=this.cometd&&!1!==this.cometd.ackEnabled,this.#a=!1,this.#b=0):"/meta/connect"===t&&this.#a&&(e.ext.ack=this.#b,this.#c("AckExtension: client sending batch",this.#b)),e}}
